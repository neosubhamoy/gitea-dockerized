{{$isTreePathRoot := not .TreeNames}}

<div class="repo-view-content-data tw-hidden" data-document-title="{{ctx.RootData.Title}}" data-document-title-common="{{ctx.RootData.PageTitleCommon}}"></div>
{{/* {{template "repo/sub_menu" .}} */}}
<div class="github-theme-templates repo-button-row">
	<div class="repo-button-row-left">
	{{if not $isTreePathRoot}}
		<button class="repo-view-file-tree-toggle-show ui compact basic button icon not-mobile {{if .UserSettingCodeViewShowFileTree}}tw-hidden{{end}}"
			data-global-click="onRepoViewFileTreeToggle" data-toggle-action="show"
			data-tooltip-content="{{ctx.Locale.Tr "repo.diff.show_file_tree"}}">
			{{svg "octicon-sidebar-collapse"}}
		</button>
	{{end}}

	{{template "repo/branch_dropdown" dict
		"Repository" .Repository
		"ShowTabBranches" true
		"ShowTabTags" true
		"CurrentRefType" .RefFullName.RefType
		"CurrentRefShortName" .RefFullName.ShortName
		"CurrentTreePath" .TreePath
		"RefLinkTemplate" "{RepoLink}/src/{RefType}/{RefShortName}/{TreePath}"
		"AllowCreateNewRef" .CanCreateBranch
		"ShowViewAllRefsEntry" true
	}}

	{{if and $isTreePathRoot (.Permission.CanRead ctx.Consts.RepoUnitTypeCode) (not .IsEmptyRepo)}}
	<div class="repository-summary">
		<a class="item muted" href="{{.RepoLink}}/branches">
			{{svg "octicon-git-branch"}} <b>{{ctx.Locale.PrettyNumber .BranchesCount}}</b> {{ctx.Locale.TrN .BranchesCount "repo.branch" "repo.branches"}}
		</a>
		{{if $.Permission.CanRead ctx.Consts.RepoUnitTypeCode}}
			<a class="item muted" href="{{.RepoLink}}/tags">
				{{svg "octicon-tag"}} <b>{{ctx.Locale.PrettyNumber .NumTags}}</b> {{ctx.Locale.TrN .NumTags "repo.tag" "repo.tags"}}
			</a>
		{{end}}
	</div>
	{{end}}

	{{if not $isTreePathRoot}}
		{{$treeNameIdxLast := Eval (len .TreeNames) "-" 1}}
		<span class="breadcrumb">
			<a class="section" href="{{.RepoLink}}/src/{{.RefTypeNameSubURL}}" title="{{.Repository.Name}}">{{StringUtils.EllipsisString .Repository.Name 30}}</a>
			{{- range $i, $v := .TreeNames -}}
				<span class="breadcrumb-divider">/</span>
				{{- if eq $i $treeNameIdxLast -}}
					<span class="active section" title="{{$v}}">{{$v}}</span>
					<button class="btn interact-fg tw-mx-1" data-clipboard-text="{{$.TreePath}}" data-tooltip-content="{{ctx.Locale.Tr "copy_path"}}">{{svg "octicon-copy" 14}}</button>
				{{- else -}}
					{{$p := index $.Paths $i}}<span class="section"><a href="{{$.BranchLink}}/{{PathEscapeSegments $p}}" title="{{$v}}">{{$v}}</a></span>
				{{- end -}}
			{{- end -}}
		</span>
	{{end}}
	</div>

	<div class="repo-button-row-right">
		<!-- Show go to file if on home page -->
		{{if $isTreePathRoot}}
			<a href="{{.Repository.Link}}/find/{{.RefTypeNameSubURL}}" class="ui compact basic button">{{ctx.Locale.Tr "repo.find_file.go_to_file"}}</a>
		{{end}}

		{{if and .RefFullName.IsBranch (not .IsViewFile)}}
			<button class="ui dropdown basic compact jump button repo-add-file" {{if not .Repository.CanEnableEditor}}disabled{{end}}>
				{{ctx.Locale.Tr "repo.editor.add_file"}}
				{{svg "octicon-triangle-down" 14 "dropdown icon"}}
				<div class="menu">
					<a class="item" href="{{.RepoLink}}/_new/{{.BranchName | PathEscapeSegments}}/{{.TreePath | PathEscapeSegments}}">
						{{svg "octicon-plus" 16}}{{ctx.Locale.Tr "repo.editor.new_file"}}
					</a>
					{{if .RepositoryUploadEnabled}}
					<a class="item" href="{{.RepoLink}}/_upload/{{.BranchName | PathEscapeSegments}}/{{.TreePath | PathEscapeSegments}}">
						{{svg "octicon-upload" 16}}{{ctx.Locale.Tr "repo.editor.upload_file"}}
					</a>
					{{end}}
					<a class="item" href="{{.RepoLink}}/_diffpatch/{{.BranchName | PathEscapeSegments}}/{{.TreePath | PathEscapeSegments}}">
						{{svg "octicon-diff" 16}}{{ctx.Locale.Tr "repo.editor.patch"}}
					</a>
				</div>
			</button>
		{{end}}

		{{if and $isTreePathRoot .Repository.IsTemplate}}
			<a role="button" class="ui primary compact button" href="{{AppSubUrl}}/repo/create?template_id={{.Repository.ID}}">
				{{ctx.Locale.Tr "repo.use_template"}}
			</a>
		{{end}}
		<!-- Only show clone panel in repository home page -->
		{{if $isTreePathRoot}}
			{{template "repo/clone_panel" .}}
		{{end}}
	</div>
</div>
{{if .IsViewFile}}
	{{template "repo/view_file" .}}
{{else if .IsBlame}}
	{{template "repo/blame" .}}
{{else}}{{/* IsViewDirectory */}}
	{{if $isTreePathRoot}}
		{{template "repo/code/upstream_diverging_info" .}}
	{{end}}
	{{template "repo/view_list" .}}
	{{if and .ReadmeExist (or .IsMarkup .IsPlainText)}}
		{{template "repo/view_file" .}}
	{{end}}
{{end}}